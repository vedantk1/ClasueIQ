<!DOCTYPE html>
<html>
<head>
    <title>Debug Frontend Auth</title>
</head>
<body>
    <h1>Frontend Authentication Debug</h1>
    <div id="output"></div>
    <button onclick="testLogin()">Test Login</button>
    <button onclick="testDocuments()">Test Documents</button>
    <button onclick="clearTokens()">Clear Tokens</button>
    
    <script>
        const API_BASE_URL = "http://localhost:8000";
        const output = document.getElementById('output');
        
        function log(message) {
            output.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
        }
        
        async function testLogin() {
            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        email: "debug@test.com",
                        password: "testpass123"
                    }),
                });
                
                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem("access_token", data.access_token);
                    localStorage.setItem("refresh_token", data.refresh_token);
                    log("Login successful! Tokens stored.");
                    log("Access token: " + data.access_token.substring(0, 50) + "...");
                } else {
                    const error = await response.json();
                    log("Login failed: " + JSON.stringify(error));
                }
            } catch (err) {
                log("Login error: " + err.message);
            }
        }
        
        async function testDocuments() {
            try {
                const accessToken = localStorage.getItem("access_token");
                log("Using access token: " + (accessToken ? accessToken.substring(0, 50) + "..." : "None"));
                
                const response = await fetch(`${API_BASE_URL}/documents/`, {
                    headers: {
                        "Authorization": `Bearer ${accessToken}`,
                        "Content-Type": "application/json"
                    }
                });
                
                log("Documents response status: " + response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    log("Documents response: " + JSON.stringify(data));
                } else {
                    const error = await response.text();
                    log("Documents error: " + error);
                }
            } catch (err) {
                log("Documents fetch error: " + err.message);
            }
        }
        
        function clearTokens() {
            localStorage.removeItem("access_token");
            localStorage.removeItem("refresh_token");
            log("Tokens cleared from localStorage");
        }
        
        // Check existing tokens on load
        window.onload = function() {
            const accessToken = localStorage.getItem("access_token");
            const refreshToken = localStorage.getItem("refresh_token");
            log("Page loaded. Access token exists: " + !!accessToken);
            log("Refresh token exists: " + !!refreshToken);
        };
    </script>
</body>
</html>
